generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  userId            String         @id @default(uuid()) @map("user_id") @db.Uuid
  fullName          String         @map("full_name") @db.VarChar(150)
  email             String         @unique @db.VarChar(150)
  phone             String?        @db.VarChar(20)
  password          String
  role              UserType       @default(staff)
  firstLogin        Boolean        @default(true) @map("first_login")
  isActive          Boolean        @default(true) @map("is_active")
  emailNotification Boolean        @default(false) @map("email_notification")
  locationIds       String[]       @map("location_ids") @db.Uuid
  createdAt         DateTime       @default(now()) @map("created_at")
  updatedAt         DateTime       @updatedAt @map("updated_at")
  UserLocation      UserLocation[]

  @@map("users")
}

model Location {
  locationId   String         @id @default(uuid()) @map("location_id") @db.Uuid
  locationCode String         @unique @map("location_code") @db.VarChar(50)
  locationName String         @map("location_name") @db.VarChar(150)
  address      String?
  city         String?
  state        String?
  country      String?
  isActive     Boolean        @default(true) @map("is_active")
  createdAt    DateTime       @default(now()) @map("created_at")
  updatedAt    DateTime       @updatedAt @map("updated_at")
  items        ItemMaster[]
  UserLocation UserLocation[]

  @@map("locations")
}

model SupplierMaster {
  supplierId    String           @id @default(uuid()) @map("supplier_id") @db.Uuid
  supplierName  String           @map("supplier_name") @db.VarChar(150)
  contactPerson String?          @map("contact_person") @db.VarChar(100)
  phone         String?          @db.VarChar(50)
  email         String?          @db.VarChar(100)
  address       String?
  vatId         String?          @map("vat_id") @db.VarChar(50)
  taxId         String?          @map("tax_id") @db.VarChar(50)
  ibanNumber    String?          @map("iban_number") @db.VarChar(50)
  gstNumber     String?          @map("gst_number") @db.VarChar(50)
  createdAt     DateTime         @default(now()) @map("created_at")
  updatedAt     DateTime         @updatedAt @map("updated_at")
  items         ItemMaster[]
  purchases     PurchaseMaster[]

  @@map("supplier_master")
}

model TypeMaster {
  typeId      String       @id @default(uuid()) @map("type_id") @db.Uuid
  typeName    String       @unique @map("type_name") @db.VarChar(100)
  description String?
  createdAt   DateTime     @default(now()) @map("created_at")
  updatedAt   DateTime     @updatedAt @map("updated_at")
  items       ItemMaster[]

  @@map("type_master")
}

model TaxMaster {
  taxId         String       @id @default(uuid()) @map("tax_id") @db.Uuid
  taxPercentage Decimal      @map("tax_percentage") @db.Decimal(5, 2)
  description   String?
  createdAt     DateTime     @default(now()) @map("created_at")
  updatedAt     DateTime     @updatedAt @map("updated_at")
  tax_name      String
  items         ItemMaster[]

  @@map("tax_master")
}

model ItemMaster {
  itemId        String           @id @default(uuid()) @map("item_id") @db.Uuid
  itemCode      String           @map("item_code") @db.VarChar(50)
  itemName      String           @map("item_name") @db.VarChar(150)
  locationId    String           @map("location_id") @db.Uuid
  openingQty    Decimal          @default(0) @map("opening_qty") @db.Decimal(10, 2)
  currentQty    Decimal          @default(0) @map("current_qty") @db.Decimal(10, 2)
  barcode       String?
  supplierId    String?          @map("supplier_id") @db.Uuid
  typeId        String?          @map("type_id") @db.Uuid
  taxId         String?          @map("tax_id") @db.Uuid
  purchasePrice Decimal          @map("purchase_price") @db.Decimal(10, 2)
  taxPercent    Decimal?         @map("tax_percent") @db.Decimal(5, 2)
  totalAmount   Decimal?         @map("total_amount") @db.Decimal(10, 2)
  createdAt     DateTime         @default(now()) @map("created_at")
  updatedAt     DateTime         @updatedAt @map("updated_at")
  location      Location         @relation(fields: [locationId], references: [locationId], onDelete: Cascade)
  supplier      SupplierMaster?  @relation(fields: [supplierId], references: [supplierId])
  tax           TaxMaster?       @relation(fields: [taxId], references: [taxId])
  type          TypeMaster?      @relation(fields: [typeId], references: [typeId])
  purchase      PurchaseMaster?
  alerts        ReorderAlert[]
  transactions  TransactionLog[]

  @@unique([itemCode, locationId])
  @@map("item_master")
}

model TransactionLog {
  transactionId   String          @id @default(uuid()) @map("transaction_id") @db.Uuid
  itemId          String          @map("item_id") @db.Uuid
  transactionType TransactionType @map("transaction_type")
  quantity        Decimal         @db.Decimal(10, 2)
  remainingQty    Decimal         @map("remaining_qty") @db.Decimal(10, 2)
  takenBy         String?         @map("taken_by")
  remarks         String?
  createdAt       DateTime        @default(now()) @map("created_at")
  updatedAt       DateTime        @updatedAt @map("updated_at")
  item            ItemMaster      @relation(fields: [itemId], references: [itemId], onDelete: Cascade)

  @@map("transaction_log")
}

model PurchaseMaster {
  purchaseId       String          @id @default(uuid()) @map("purchase_id") @db.Uuid
  itemId           String          @unique @map("item_id") @db.Uuid
  availableQty     Decimal?        @map("available_qty") @db.Decimal(10, 2)
  rol              Decimal         @db.Decimal(10, 2)
  moq              Decimal?        @db.Decimal(10, 2)
  eoq              Decimal?        @db.Decimal(10, 2)
  lastPurchaseDate DateTime?       @map("last_purchase_date")
  supplierId       String?         @map("supplier_id") @db.Uuid
  createdAt        DateTime        @default(now()) @map("created_at")
  updatedAt        DateTime        @updatedAt @map("updated_at")
  item             ItemMaster      @relation(fields: [itemId], references: [itemId], onDelete: Cascade)
  supplier         SupplierMaster? @relation(fields: [supplierId], references: [supplierId])

  @@map("purchase_master")
}

model ReorderAlert {
  alertId   String      @id @default(uuid()) @map("alert_id") @db.Uuid
  itemId    String      @map("item_id") @db.Uuid
  alertType AlertType   @map("alert_type")
  status    AlertStatus @default(pending)
  alertDate DateTime    @default(now()) @map("alert_date")
  updatedAt DateTime    @updatedAt @map("updated_at")
  item      ItemMaster  @relation(fields: [itemId], references: [itemId], onDelete: Cascade)

  @@map("reorder_alerts")
}

model UserLocation {
  id String @id @default(uuid()) @db.Uuid

  userId     String @map("user_id") @db.Uuid
  locationId String @map("location_id") @db.Uuid

  user     User     @relation(fields: [userId], references: [userId], onDelete: Cascade)
  location Location @relation(fields: [locationId], references: [locationId])

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@unique([userId, locationId])
  @@map("user_locations")
}

model Invoice {
  invoiceId      String        @id @default(uuid()) @map("invoice_id") @db.Uuid
  invoiceNumber  String        @unique @map("invoice_number") @db.VarChar(100)
  invoiceName    String        @map("invoice_name") @db.VarChar(200)
  supplierId     String?       @map("supplier_id") @db.Uuid
  amount         Decimal       @db.Decimal(10, 2)
  invoiceDate    DateTime      @map("invoice_date")
  dueDate        DateTime      @map("due_date")
  status         InvoiceStatus @default(pending)
  paidDate       DateTime?     @map("paid_date")
  paymentMode    String?       @map("payment_mode") @db.VarChar(50)
  notes          String?
  locationId     String        @map("location_id") @db.Uuid
  createdBy      String        @map("created_by") @db.Uuid
  createdAt      DateTime      @default(now()) @map("created_at")
  updatedAt      DateTime      @updatedAt @map("updated_at")

  @@map("invoices")
}

enum UserType {
  admin
  manager
  staff
}

enum TransactionType {
  checkin
  checkout
}

enum AlertType {
  ROL
  EOQ
}

enum AlertStatus {
  pending
  sent
  acknowledged
}

enum InvoiceStatus {
  pending
  paid
  overdue
  cancelled
}
